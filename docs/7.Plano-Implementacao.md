# Plano de Implementação

Este documento descreve o plano detalhado de implementação do sistema de consulta de clima por CEP.

## Resumo do Projeto

Sistema em Go que recebe um CEP, identifica a cidade via ViaCEP e retorna a temperatura atual em Celsius, Fahrenheit e Kelvin via WeatherAPI. Deploy no Google Cloud Run.

---

## Fases de Implementação

### Fase 1: Setup e Estrutura Base

**Duração estimada**: 30 minutos

| # | Tarefa | Arquivo |
|---|--------|---------|
| 1.1 | Criar estrutura de diretórios | - |
| 1.2 | Configurar go.mod (Go 1.25) | `go.mod` |
| 1.3 | Criar arquivo de configuração | `configs/config.go` |
| 1.4 | Criar Makefile com comandos úteis | `Makefile` |
| 1.5 | Atualizar docker-compose.yml | `docker-compose.yml` |

---

### Fase 2: Camada de Domínio

**Duração estimada**: 20 minutos

| # | Tarefa | Arquivo |
|---|--------|---------|
| 2.1 | Criar entidade Location | `internal/domain/entity/location.go` |
| 2.2 | Criar entidade Weather | `internal/domain/entity/weather.go` |
| 2.3 | Criar erros de domínio | `internal/domain/errors.go` |
| 2.4 | Criar interface LocationRepository | `internal/domain/repository/location.go` |
| 2.5 | Criar interface WeatherRepository | `internal/domain/repository/weather.go` |

```go
// Estruturas esperadas

type Location struct {
    City  string
    State string
}

type Weather struct {
    TempC float64 `json:"temp_C"`
    TempF float64 `json:"temp_F"`
    TempK float64 `json:"temp_K"`
}
```

---

### Fase 3: Clientes de APIs Externas

**Duração estimada**: 45 minutos

| # | Tarefa | Arquivo |
|---|--------|---------|
| 3.1 | Implementar cliente ViaCEP | `internal/infra/external/viacep/client.go` |
| 3.2 | Criar testes para ViaCEP | `internal/infra/external/viacep/client_test.go` |
| 3.3 | Implementar cliente WeatherAPI | `internal/infra/external/weatherapi/client.go` |
| 3.4 | Criar testes para WeatherAPI | `internal/infra/external/weatherapi/client_test.go` |

---

### Fase 4: Caso de Uso

**Duração estimada**: 30 minutos

| # | Tarefa | Arquivo |
|---|--------|---------|
| 4.1 | Implementar GetWeatherByZipcodeUseCase | `internal/usecase/get_weather.go` |
| 4.2 | Criar testes para o use case | `internal/usecase/get_weather_test.go` |

```go
// Interface do Use Case
type GetWeatherByZipcodeUseCase interface {
    Execute(ctx context.Context, zipcode string) (*entity.Weather, error)
}
```

---

### Fase 5: Camada HTTP

**Duração estimada**: 30 minutos

| # | Tarefa | Arquivo |
|---|--------|---------|
| 5.1 | Criar handler HTTP | `internal/infra/web/handler.go` |
| 5.2 | Criar middleware de logging | `internal/infra/web/middleware.go` |
| 5.3 | Criar testes de integração | `internal/infra/web/handler_test.go` |

```go
// Rotas esperadas
// GET /weather/{cep} - Retorna temperatura por CEP
```

---

### Fase 6: Entry Point e Injeção de Dependências

**Duração estimada**: 20 minutos

| # | Tarefa | Arquivo |
|---|--------|---------|
| 6.1 | Atualizar main.go | `cmd/api/main.go` |
| 6.2 | Mover main.go atual | `main.go` → `cmd/api/main.go` |

---

### Fase 7: Docker e Deploy

**Duração estimada**: 30 minutos

| # | Tarefa | Arquivo |
|---|--------|---------|
| 7.1 | Atualizar Dockerfile | `Dockerfile` |
| 7.2 | Criar docker-compose.yml | `docker-compose.yml` |
| 7.3 | Testar build local | - |
| 7.4 | Deploy no Cloud Run | - |

---

### Fase 8: Documentação Final

**Duração estimada**: 15 minutos

| # | Tarefa | Arquivo |
|---|--------|---------|
| 8.1 | Atualizar README.md | `README.md` |
| 8.2 | Adicionar exemplos de uso | `README.md` |
| 8.3 | Documentar URL do Cloud Run | `README.md` |

---

## Cronograma Total

| Fase | Descrição | Tempo |
|------|-----------|-------|
| 1 | Setup e Estrutura | 30 min |
| 2 | Domínio | 20 min |
| 3 | APIs Externas | 45 min |
| 4 | Use Case | 30 min |
| 5 | HTTP Handler | 30 min |
| 6 | Entry Point | 20 min |
| 7 | Docker/Deploy | 30 min |
| 8 | Documentação | 15 min |
| **Total** | - | **~4 horas** |

---

## Plano de Verificação

### Testes Automatizados

```bash
# Executar todos os testes
go test ./... -v

# Executar com cobertura
go test ./... -cover -coverprofile=coverage.out

# Visualizar cobertura
go tool cover -html=coverage.out
```

### Testes Manuais

#### 1. Teste Local com Docker

```bash
# Build e run
docker-compose up --build

# Em outro terminal, testar endpoints
curl http://localhost:8080/weather/01310100
curl http://localhost:8080/weather/123
curl http://localhost:8080/weather/99999999

#### 2. Teste com REST Client

Como alternativa ao `curl`, você pode usar o arquivo `api/api.http` diretamente no VS Code.

#### 3. Teste no Cloud Run

```bash
# Teste no serviço ativo
curl https://weather-api-nccto6oxnq-uc.a.run.app/weather/01310100
```

### Casos de Teste Obrigatórios

| CEP | Esperado | Código HTTP |
|-----|----------|-------------|
| `01310100` | JSON com temperaturas | 200 |
| `123` | `invalid zipcode` | 422 |
| `00000000` | `can not find zipcode` | 404 |
| `99999999` | `can not find zipcode` | 404 |

---

## Dependências Externas

| Dependência | Tipo | Necessário Para |
|-------------|------|-----------------|
| WeatherAPI Key | API Key | Consulta de clima |
| Conta Google Cloud | Conta | Deploy |
| Docker | Ferramenta | Build e testes |

---

## Riscos e Mitigações

| Risco | Probabilidade | Mitigação |
|-------|---------------|-----------|
| Rate limit WeatherAPI | Baixa | Implementar cache opcional |
| ViaCEP indisponível | Baixa | Retry com backoff |
| Problemas de encoding | Média | Normalizar cidade antes de enviar para WeatherAPI |

---

## Próximos Passos

1. ✅ Documentação de planejamento
2. ✅ Implementação do código
3. ✅ Testes automatizados
4. ✅ Build Docker local
5. ✅ Deploy no Cloud Run
6. ✅ Documentação final
