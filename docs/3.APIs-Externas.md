# APIs Externas

Este documento descreve as APIs externas utilizadas pelo sistema.

## 1. ViaCEP

API brasileira gratuita para consulta de CEPs.

### Informações Gerais

| Propriedade | Valor |
|-------------|-------|
| **URL Base** | `https://viacep.com.br/ws/` |
| **Autenticação** | Não requer |
| **Rate Limit** | Não especificado |
| **Documentação** | https://viacep.com.br/ |

### Endpoint Utilizado

```http
GET https://viacep.com.br/ws/{cep}/json/
```

### Parâmetros

| Parâmetro | Tipo | Descrição |
|-----------|------|-----------|
| `cep` | string | CEP com 8 dígitos (apenas números) |

### Resposta de Sucesso (200 OK)

```json
{
  "cep": "01310-100",
  "logradouro": "Avenida Paulista",
  "complemento": "até 610 - lado par",
  "unidade": "",
  "bairro": "Bela Vista",
  "localidade": "São Paulo",
  "uf": "SP",
  "estado": "São Paulo",
  "regiao": "Sudeste",
  "ibge": "3550308",
  "gia": "1004",
  "ddd": "11",
  "siafi": "7107"
}
```

### Resposta de CEP Não Encontrado

```json
{
  "erro": "true"
}
```

> [!IMPORTANT]
> Quando o CEP não existe, a API retorna **status 200** com o campo `"erro": "true"`.
> Isso deve ser tratado como um caso de erro na aplicação.

### Campos Relevantes para o Projeto

| Campo | Descrição | Uso |
|-------|-----------|-----|
| `localidade` | Nome da cidade | Buscar clima |
| `uf` | Sigla do estado | Contexto adicional |
| `erro` | Indica CEP não encontrado | Tratamento de erro |

---

## 2. WeatherAPI

API de previsão do tempo com plano gratuito generoso.

### Informações Gerais

| Propriedade | Valor |
|-------------|-------|
| **URL Base** | `https://api.weatherapi.com/v1/` |
| **Autenticação** | API Key via query parameter |
| **Rate Limit** | 1.000.000 chamadas/mês (free tier) |
| **Documentação** | https://www.weatherapi.com/docs/ |

### Configuração

1. Criar conta em https://www.weatherapi.com/
2. Copiar a API Key do dashboard
3. Configurar como variável de ambiente: `WEATHER_API_KEY`

### Endpoint Utilizado

```http
GET https://api.weatherapi.com/v1/current.json?key={api_key}&q={city}&aqi=no
```

### Parâmetros

| Parâmetro | Tipo | Obrigatório | Descrição |
|-----------|------|-------------|-----------|
| `key` | string | Sim | API Key de autenticação |
| `q` | string | Sim | Cidade para consulta |
| `aqi` | string | Não | Incluir qualidade do ar (no = não incluir) |

### Resposta de Sucesso (200 OK)

```json
{
  "location": {
    "name": "Sao Paulo",
    "region": "Sao Paulo",
    "country": "Brazil",
    "lat": -23.53,
    "lon": -46.62,
    "tz_id": "America/Sao_Paulo",
    "localtime_epoch": 1702900800,
    "localtime": "2024-12-18 12:00"
  },
  "current": {
    "last_updated_epoch": 1702900500,
    "last_updated": "2024-12-18 11:55",
    "temp_c": 28.0,
    "temp_f": 82.4,
    "is_day": 1,
    "condition": {
      "text": "Partly cloudy",
      "icon": "//cdn.weatherapi.com/weather/64x64/day/116.png",
      "code": 1003
    },
    "wind_mph": 11.9,
    "wind_kph": 19.1,
    "wind_degree": 90,
    "wind_dir": "E",
    "pressure_mb": 1016.0,
    "pressure_in": 30.0,
    "precip_mm": 0.0,
    "precip_in": 0.0,
    "humidity": 65,
    "cloud": 25,
    "feelslike_c": 30.8,
    "feelslike_f": 87.4,
    "vis_km": 10.0,
    "vis_miles": 6.0,
    "uv": 7.0,
    "gust_mph": 15.0,
    "gust_kph": 24.1
  }
}
```

### Campos Relevantes para o Projeto

| Campo | Descrição | Uso |
|-------|-----------|-----|
| `current.temp_c` | Temperatura em Celsius | Valor base para conversões |

### Códigos de Erro

| Código | Descrição |
|--------|-----------|
| 400 | Requisição inválida |
| 401 | API Key inválida ou ausente |
| 403 | API Key desabilitada |

---

## Considerações de Implementação

### Timeout e Resiliência

```go
// Configurar timeout nas requisições HTTP
client := &http.Client{
    Timeout: 10 * time.Second,
}
```

### Cache (Opcional)

Para melhorar performance e reduzir chamadas às APIs:

- **ViaCEP**: CEPs podem ser cacheados por tempo indeterminado (dados raramente mudam)
- **WeatherAPI**: Clima pode ser cacheado por 5-10 minutos

### Tratamento de Erros

| API | Situação | Ação |
|-----|----------|------|
| ViaCEP | CEP não encontrado | Retornar HTTP 404 |
| ViaCEP | Timeout/Erro de rede | Retornar HTTP 500 |
| WeatherAPI | Cidade não encontrada | Retornar HTTP 404 |
| WeatherAPI | API Key inválida | Log de erro + HTTP 500 |
| WeatherAPI | Rate limit excedido | Log de erro + HTTP 503 |
